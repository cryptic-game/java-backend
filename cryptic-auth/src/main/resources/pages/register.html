<!doctype html>
<html dir="ltr" lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Cryptic Auth</title>
  <link href="https://cryptic-game.net/favicon.ico" rel="icon" type="image/x-icon">
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
      background-color: #000;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Open Sans, Helvetica Neue, sans-serif;
    }

    section {
      display: flex;
      align-items: center;
      background-color: rgba(43, 43, 43, .8);
      border-radius: 2rem;
      padding: 2rem;
      column-gap: 1rem;
    }

    svg {
      width: 6rem;
      height: 6rem;
    }

    a {
      color: #fff;
      transition: color 200ms ease-in-out;
    }

    a:hover {
      color: #b0b0b0;
    }

    .username-error {
      color: red;
    }

    .hidden {
      display: none;
    }

  </style>
</head>
<body>
<section>
  <svg viewBox="0 0 78.176 99.327" xmlns="http://www.w3.org/2000/svg"
       xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs id="defs5820">
      <linearGradient gradientUnits="userSpaceOnUse" id="linear-gradient-33" x1="304.88" x2="328.14" y1="157.16"
                      y2="157.16">
        <stop id="stop40" offset="0" stop-color="#95c11f"/>
        <stop id="stop42" offset=".67" stop-color="#3aaa35"/>
        <stop id="stop44" offset="1" stop-color="#008d36"/>
      </linearGradient>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-38-7" x1="0"
                      x2="9.97" xlink:href="#linear-gradient-33"
                      y1="173.45" y2="173.45"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-39-7" x1=".009"
                      x2="27.62" xlink:href="#linear-gradient-33"
                      y1="200.94" y2="200.94"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-40-9" x1="55.83"
                      x2="84.07" xlink:href="#linear-gradient-33"
                      y1="207.29" y2="207.29"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-41-7" x1="23.99"
                      x2="65.67" xlink:href="#linear-gradient-33"
                      y1="217.67" y2="217.67"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-46-3" x1="45.51"
                      x2="79.12" xlink:href="#linear-gradient-33"
                      y1="194.63" y2="194.63"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-45-9" x1="14.39"
                      x2="42.52" xlink:href="#linear-gradient-33"
                      y1="192.89" y2="192.89"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-44-6" x1="16.88"
                      x2="73.9" xlink:href="#linear-gradient-33"
                      y1="172.97" y2="172.97"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-43-5" x1="26.59"
                      x2="65.68" xlink:href="#linear-gradient-33"
                      y1="155.7" y2="155.7"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-42-4" x1="61"
                      x2="84.19" xlink:href="#linear-gradient-33"
                      y1="145.11" y2="145.11"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-36-0" x1="30.59"
                      x2="73.1" xlink:href="#linear-gradient-33"
                      y1="131.66" y2="131.66"/>
      <linearGradient gradientTransform="matrix(.91743 0 0 .91743 24.904 19.435)" id="linear-gradient-37-7" x1="0"
                      x2="32.71" xlink:href="#linear-gradient-33"
                      y1="145.15" y2="145.15"/>
    </defs>
    <g id="layer1" transform="translate(-24.408 -130.454)">
      <path
          d="M52.968 149.573c4.05-2.42 8.144-4.766 12.183-7.202 1.716-1.01 1.89-.918 3.496 0 4.125 2.433 7.96 4.693 12.22 7.22l11.1-4.23c-7.795-4.563-16.001-9.373-23.504-13.76-1.514-.918-1.651-.918-3.064 0-3.444 2.103-6.988 4.04-10.496 6.036z"
          fill="url(#linear-gradient-36-0)" id="path970-5-5-2-2" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path
          d="M34.078 167.545v-5.128c0-1.505 0-1.689 1.174-2.404 6.134-3.568 12.446-7.364 17.716-10.44l1.935-11.936-7.504 4.413c-7.452 4.458-13.94 8.134-20.587 12.156-1.606.917-1.835 1.376-1.835 3.091v5.954z"
          fill="url(#linear-gradient-37-7)" id="path972-8-25-2-3" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path d="M34.078 189.82v-22.275l-9.101-4.294-.073 30.606z" fill="url(#linear-gradient-38-7)" id="path974-2-1-2-7"
            stroke="#010101" stroke-dasharray="none" stroke-linecap="round" stroke-linejoin="round"
            stroke-miterlimit="7.95"
            stroke-width=".917"/>
      <path
          d="M50.243 208.948a2754.741 2754.741 0 0 1-15.184-8.917c-1-.587-1.018-.715-1.018-1.835l.037-8.376-9.175 4.037-.036 9.32c0 1.47-.003 1.537 1.447 2.375 7.894 4.676 13.085 7.781 20.571 12.185z"
          fill="url(#linear-gradient-39-7)" id="path976-7-6-2-4" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path
          d="M85.128 218.824c5.337-3.19 10.696-6.346 16.06-9.49.723-.418.977-1.03.761-1.835-.51-1.942-1.059-3.89-1.56-5.817-.486-1.88-2.33-1.32-3.577-.587-6.862 4.191-14.473 8.6-20.688 12.257z"
          fill="url(#linear-gradient-40-9)" id="path978-9-7-2-7" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path
          d="M46.922 217.756c6.897 4.055 12.83 7.554 18.734 11.027 1.183.698 1.293.716 2.394.064 6.518-3.837 10.985-6.45 17.184-10.082l-9.034-5.458c-2.985 1.785-5.402 3.156-8.15 4.77-.72.416-1.457.473-2.192.064-5.202-3.07-10.409-6.13-15.615-9.193z"
          fill="url(#linear-gradient-41-7)" id="path980-7-5-2-2" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path
          d="M80.867 149.59c5.49 3.27 11.104 6.333 16.513 9.735 1.349.789 2.588.532 2.991-.918a1096.13 1096.13 0 0 0 1.578-5.789l.165-.587a.862.862 0 0 0-.486-.917c-3.237-1.89-6.448-3.822-9.66-5.752z"
          fill="url(#linear-gradient-42-4)" id="path982-3-2-2-4" stroke="#010101" stroke-dasharray="none"
          stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="7.95" stroke-width=".917"/>
      <path d="m54.82 151.857 13.762-2.633 14.68 6.128 1.834 17.055-17.431 2.918-18.459-5.083z"
            fill="url(#linear-gradient-43-5)"
            id="path986-5-0-2-2" stroke="#010101" stroke-dasharray="none" stroke-miterlimit="7.95"
            stroke-width=".917"/>
      <path d="m40.39 173.894 8.816-3.652 18.459 5.083 17.431-2.918 7.633 6.743-24.44 6.166-13.386-5.46z"
            fill="url(#linear-gradient-44-6)" id="path988-0-7-2-0" stroke="#010101" stroke-dasharray="none"
            stroke-miterlimit="7.95" stroke-width=".917"/>
      <path d="m38.105 181.664 6.422-2.752 5.945 1.835v13.247l13.248 10.964.22 8.908-16.697-17.587z"
            fill="url(#linear-gradient-45-9)" id="path990-2-6-2-7" stroke="#010101" stroke-dasharray="none"
            stroke-miterlimit="7.95" stroke-width=".917"/>
      <path d="m97.49 183.949-12.788 14.155-18.046 15.303.917-7.761 13.936-9.826 6.422-11.871 4.11-1.377z"
            fill="url(#linear-gradient-46-3)" id="path992-3-6-2-2" stroke="#010101" stroke-dasharray="none"
            stroke-miterlimit="7.95" stroke-width=".917"/>
      <path
          d="M63.257 183.565c-.068.156-1.778 1.195-2.849 1.356a4.853 4.853 0 0 1-4.927-2.468 4.358 4.358 0 0 1-.376-2.284"
          fill="#fff" id="path996-9-8-2-9" stroke="#010101" stroke-dasharray="none" stroke-miterlimit="7.95"
          stroke-width=".917"/>
      <path
          d="M81.509 182.123c.044.682-1.18 2.245-2.165 3.046a6.67 6.67 0 0 1-5.505 1.303c-1.083-.268-2.582-.776-2.862-1.615"
          fill="#fff" id="path1004-8-7-2-8" stroke="#010101" stroke-dasharray="none" stroke-miterlimit="7.95"
          stroke-width=".917"/>
    </g>
  </svg>
  <div>
    <h1>Choose a username</h1>
    <form action="../../user/register" method="post">
      <label>
        Username:
        <input maxlength="20" name="name" oninput="checkUsername(this.value, this.checkValidity())" pattern="^[a-zA-Z\d_]{3,20}$" required
               type="text">
      </label>
      <label>
        <input disabled id="username-submit" type="submit" value="Submit">
      </label>
      <p>Allowed usernames: <code>^[a-zA-Z\d_]{3,20}$</code></p>
      <p class="username-error hidden" id="username-gone">Username gone</p>
      <p class="username-error hidden" id="username-not-acceptable">Username not acceptable</p>
      <p class="username-error hidden" id="username-unavailable-for-legal-reasons">Username unavailable for legal
        reasons</p>
      <p class="username-error hidden" id="username-unexpected-error">Unexpected error</p>
    </form>
    <script defer>
      const debounce = (callback, wait) => {
        let timeoutId = null;
        return (...args) => {
          window.clearTimeout(timeoutId);
          timeoutId = window.setTimeout(() => {
            callback.apply(null, args);
          }, wait);
        };
      }

      const errors = {
        "410": "username-gone",
        "406": "username-not-acceptable",
        "451": "username-unavailable-for-legal-reasons",
        "any": "username-unexpected-error"
      };

      function checkUsername(name, valid) {
        document.getElementById("username-submit").disabled = true;
        if (valid) {
          checkUsername0(name);
        }
      }

      const checkUsername0 = debounce(name => {
        fetch("../../user/name", {
          method: "POST",
          headers: {"Content-Type": "text/plain"},
          body: name
        }).then(response => {
          Object.values(errors).forEach(id => document.getElementById(id).classList.add("hidden"));
          if (response.status === 200) {
            document.getElementById("username-submit").disabled = false;
            return;
          }
          document.getElementById(errors[`${response.status}`] || errors["any"]).classList.remove("hidden");
        });
      }, 1000);
    </script>
  </div>
</section>
</body>
</html>
